<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <link type="text/css" rel="stylesheet" href="styles/styles.css"></link>
    <title></title>
</head>
<body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://vk.com/js/api/openapi.js?159" type="text/javascript"></script>

    <script src="app/jquery.tmpl.js" type="text/javascript"></script>
    <script src="app/vkAppEvents.js" type="text/javascript"></script>
    <script src="app/eventBroker.js" type="text/javascript"></script>
    <script src="app/callService.js" type="text/javascript"></script>
    <script src="app/searchService.js" type="text/javascript"></script>
    <script src="app/urlHelper.js" type="text/javascript"></script>
    <script src="app/resultsController.js" type="text/javascript"></script>
    <script src="app/filtersController.js" type="text/javascript"></script>
    <script src="app/app.js" type="text/javascript"></script>

    <script type="text/javascript">
        $(function () {
            var urlHelper = new UrlHelper();
            var callService = new CallService();
            var eventBroker = new EventBroker();
            var filtersController = new FiltersController(urlHelper, eventBroker);
            var searchService = new SearchService(callService, eventBroker);
            var resultsController = new ResultsController(eventBroker);
            var app = new VkApp(urlHelper, callService, eventBroker);

            $("#initAppButton").click(function () {
                var authResponseUrl = $("#loginResult").val();
                if (authResponseUrl) {
                    app.init(authResponseUrl);
                }
            });
        });


        function login() {
            window.w = window.open(
                "https://oauth.vk.com/authorize?client_id=6757014&display=page&redirect_uri=https://oauth.vk.com/blank.html&scope=friends,messages,wall&response_type=token&v=5.87",
                "",
                'height=600,width=800,toolbar=no,directories=no,status=no,menubar=no,scrollbars=no,resizable=no,modal=yes');
            window.w.onload = function () {
                alert("load!");
            }
        }

    </script>

    <div class="panel initialization">
        <label class="title">Авторизация</label>
        <label>Перейдите на страницу <a onclick="login()" href="#">авторизации</a></label>
        <br />
        И введите результат из адресной строки сюда: <input id="loginResult" type="text"/>
        <button id="initAppButton">Готово</button>
    </div>

    <div class="app" style="display: none">
        <div class="panel filter">
            <label class="title">Фильтр пользователей</label>

            <div class="row">
                <label for="postId">Пставили лайк:</label>
                <input type="text" id="postId" value="https://vk.com/id34545583?w=wall34545583_801%2Fall"/>
            </div>
            
            <div class="row">
                <input type="checkbox" id="subscriptionEnabledCheckbox"/>
                <label for="subscriptionEnabledCheckbox">не подписаны в группу</label>
                <input type="text" id="subscriptionInput" style="display: none"/>
            </div>
            
            <div class="row">
                <input type="checkbox" id="withoutConversationsWithMe"/>
                <label for="withoutConversationsWithMe">только те, у кого нет переписок со мной</label>
            </div>
            
            <div class="row">
                <input type="checkbox" id="canSendMessage"/>
                <label for="canSendMessage">только те, кому я могу отправлять сообщения</label>
            </div>
            
            <div class="row">
                <label for="canSendMessage">Показать первых</label>
                <select id="hitsCount">
                    <option value="10">10</option>
                    <option value="20" selected="selected">20</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
                <label for="canSendMessage">пользователей</label>
            </div>
            
            <div class="row buttons">
                <button id="searchButton">Искать!</button>
            </div>
        </div>

        <div class="panel ">
            <label class="title">Результаты</label>
            <div class="row results">
            </div>
        </div>

        <div class="panel message-panel" style="display: none">
            <label class="title">Разослать сообщение</label>
            <input type="text" id="message" />
            <button id="sendMessageButton">Send message</button>
        </div>
    </div>

</body>
</html>