<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <link type="text/css" rel="stylesheet" href="styles/styles.css"></link>
    <title></title>
</head>
<body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://vk.com/js/api/openapi.js?159" type="text/javascript"></script>

    <script src="app/jquery.tmpl.js" type="text/javascript"></script>
    <script src="app/vkAppEvents.js" type="text/javascript"></script>
    <script src="app/eventBroker.js" type="text/javascript"></script>
    <script src="app/callService.js" type="text/javascript"></script>
    <script src="app/searchService.js" type="text/javascript"></script>
    <script src="app/urlHelper.js" type="text/javascript"></script>
    <script src="app/resultsController.js" type="text/javascript"></script>
    <script src="app/filtersController.js" type="text/javascript"></script>
    <script src="app/messagesController.js" type="text/javascript"></script>
    <script src="app/messageSender.js" type="text/javascript"></script>
    <script src="app/messagesFormatter.js" type="text/javascript"></script>
    <script src="app/appContext.js" type="text/javascript"></script>
    <script src="app/app.js" type="text/javascript"></script>

    <script type="text/javascript">
        $(function () {
            var app = new VkApp();

            $("#initAppButton").click(function () {
                var authResponseUrl = $("#loginResult").val();
                app.init(authResponseUrl);
            });
        });
    </script>

    <div class="panel initialization">
        <label class="title">Авторизация</label>
        <label>Перейдите на страницу <a href="https://oauth.vk.com/authorize?client_id=6757014&display=page&redirect_uri=https://oauth.vk.com/blank.html&scope=friends,messages,wall&response_type=token&v=5.87" target="_blank">авторизации</a></label>
        <br />
        И введите результат из адресной строки сюда: <input id="loginResult" type="text"/>
        <button id="initAppButton">Готово</button>
    </div>

    <div class="app" style="display: none">
        <div class="panel filter">
            <label class="title">Фильтр пользователей</label>

            <div class="row">
                <label for="postId">Пставили лайк:</label>
                <input type="text" id="postId" />
            </div>

            <div class="row">
                <input type="checkbox" checked="checked" id="subscriptionEnabledCheckbox" />
                <label for="subscriptionEnabledCheckbox">не подписаны в группу</label>
                <input type="text" id="subscriptionInput" class="subscriptions-input" value="https://vk.com/aillion" />
            </div>

            <div class="row">
                <input type="checkbox" checked="checked" id="withoutConversationsWithMe" />
                <label for="withoutConversationsWithMe">только те, у кого нет переписок со мной</label>
            </div>

            <div class="row">
                <input type="checkbox" checked="checked" id="canSendMessage" />
                <label for="canSendMessage">только те, кому я могу отправлять сообщения</label>
            </div>

            <div class="row">
                <label for="canSendMessage">Показать первых</label>
                <select id="hitsCount">
                    <option value="10">10</option>
                    <option value="20" selected="selected">20</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
                <label for="canSendMessage">пользователей</label>
            </div>

            <div class="row buttons">
                <button id="searchButton">Искать!</button>
            </div>
        </div>

        <div class="panel ">
            <label class="title">Результаты</label>
            <div class="row results">
            </div>
        </div>

        <div class="panel message-panel" style="display: none">
            <label class="title">Разослать сообщение</label>
            <div class="row">
                <div class="column">
                    <textarea id="message"></textarea>
                </div>
                <div class="column">
                    <div class="options-btn first-name">Имя</div>
                    <div class="options-btn last-name">Фамилия</div>
                    <div class="options-btn attachment">+ Прикрепить</div>
                </div>
            </div>
            <div class="row">
                <label class="title">Вложения:</label>
                <div class="attachments" id="attachments">

                </div>
            </div>
            <div class="row buttons">
                <button id="sendMessageToMeButton">Отправить себе</button>
                <button id="sendMessageButton">Отправить <b>всем!</b></button>
            </div>
        </div>
    </div>

    <script id="usersTemplate" type="text/x-jquery-tmpl">
        <div class="user {{if !can_write_private_message}}disabled{{/if}}" user-id="${id}">
            <div class="avatar">
                <img src='${photo_50}' />
            </div>
            <div class="info-panel">
                <a href="https://vk.com/id${id}">${first_name} ${last_name}</a>
            </div>
            <div class="status-panel">
                {{if !can_write_private_message}}<div class="disabled"></div>{{/if}}
            </div>
        </div>
    </script>

    <script id="attachmentTemplate" type="text/x-jquery-tmpl">
        <div class="attachment" attachment-id="${id}">
            <div>${type} - ${name}</div>
            <div class="remove-btn">x</div>
        </div>
    </script>
</body>
</html>